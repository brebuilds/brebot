<!DOCTYPE html>
<html lang="en" x-data="{ darkMode: localStorage.getItem('darkMode') === 'true' }" :class="{ 'dark': darkMode }">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content="Brebot">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Brebot">
    <meta name="description" content="AI-powered knowledge management and bot organization platform">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="msapplication-config" content="/static/icons/browserconfig.xml">
    <meta name="msapplication-TileColor" content="#3b82f6">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="theme-color" content="#3b82f6">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/static/manifest.json">
    
    <!-- Icons -->
    <link rel="apple-touch-icon" href="/static/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/icons/favicon-16x16.png">
    <link rel="shortcut icon" href="/static/icons/favicon.ico">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Monaco Editor -->
    <script src="https://unpkg.com/monaco-editor@0.44.0/min/vs/loader.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        },
                        accent: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            200: '#bbf7d0',
                            300: '#86efac',
                            400: '#4ade80',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                            800: '#166534',
                            900: '#14532d',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'bounce-gentle': 'bounceGentle 2s infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        bounceGentle: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .dark body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        
        .panel {
            height: calc(100vh - 6rem);
            overflow-y: auto;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dark .panel {
            background: rgba(31, 41, 55, 0.95);
            border: 1px solid rgba(75, 85, 99, 0.3);
        }
        
        /* Mobile responsive adjustments */
        @media (max-width: 1024px) {
            .panel {
                height: auto;
                min-height: 300px;
                max-height: 50vh;
            }
        }
        
        @media (max-width: 768px) {
            .panel {
                max-height: 40vh;
            }
        }
        
        .bot-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dark .bot-card {
            background: rgba(31, 41, 55, 0.9);
            border: 1px solid rgba(75, 85, 99, 0.3);
        }
        
        .bot-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .dark .bot-card:hover {
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            box-shadow: 0 0 10px currentColor;
        }
        
        .status-online { 
            background-color: #22c55e; 
            color: #22c55e;
            animation: pulse-slow 2s infinite;
        }
        .status-busy { 
            background-color: #f59e0b; 
            color: #f59e0b;
            animation: bounce-gentle 1.5s infinite;
        }
        .status-offline { 
            background-color: #ef4444; 
            color: #ef4444;
        }
        .status-error { 
            background-color: #dc2626; 
            color: #dc2626;
            animation: pulse 1s infinite;
        }
        
        .chat-message {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .file-item {
            transition: background-color 0.2s ease;
        }
        .file-item:hover {
            background-color: #f3f4f6;
        }
        
        .pipeline-step {
            transition: all 0.3s ease;
        }
        .pipeline-step.completed {
            background-color: #d1fae5;
            border-color: #10b981;
        }
        .pipeline-step.running {
            background-color: #fef3c7;
            border-color: #f59e0b;
            animation: pulse 2s infinite;
        }
        .pipeline-step.pending {
            background-color: #f3f4f6;
            border-color: #d1d5db;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
    
    <!-- Dynamic Theme CSS -->
    <link id="user-theme-css" rel="stylesheet" type="text/css" href="/static/user_theme.css" />
</head>
<body class="min-h-screen" x-data="dashboardApp()" x-init="init()">
    <!-- Enhanced Header -->
    <header class="backdrop-blur-md bg-white/90 dark:bg-gray-900/90 shadow-lg border-b border-gray-200/20 dark:border-gray-700/20 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-primary-600 to-accent-600 bg-clip-text text-transparent">
                            <i class="fas fa-robot text-primary-500 mr-2 animate-bounce-gentle"></i>
                            Brebot Enhanced
                        </h1>
                    </div>
                    <div class="hidden md:flex items-center space-x-2 text-sm">
                        <span class="text-gray-600 dark:text-gray-400">Online Bots:</span>
                        <span class="font-semibold text-accent-600 dark:text-accent-400" x-text="onlineBots"></span>
                        <span class="text-gray-400">â€¢</span>
                        <span class="text-gray-600 dark:text-gray-400">Active Tasks:</span>
                        <span class="font-semibold text-primary-600 dark:text-primary-400" x-text="activeTasks.length"></span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Setup Panel Toggle -->
                    <button @click="openSetupPanel()" class="px-3 py-2 text-xs bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 rounded-lg hover:bg-primary-200 dark:hover:bg-primary-900/50 transition-all duration-200 flex items-center">
                        <i class="fas fa-rocket mr-2"></i>
                        Setup
                    </button>
                    <!-- System Status -->
                    <div class="flex items-center space-x-2">
                        <div class="w-3 h-3 rounded-full shadow-lg" :class="{
                            'bg-accent-500 animate-pulse-slow': systemStatus === 'healthy',
                            'bg-yellow-500 animate-bounce-gentle': systemStatus === 'warning',
                            'bg-red-500 animate-pulse': systemStatus === 'error'
                        }"></div>
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300 capitalize" x-text="systemStatus"></span>
                    </div>
                    
                    <!-- Dark Mode Toggle -->
                    <button @click="toggleDarkMode()" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 transition-all duration-200">
                        <i class="fas fa-moon dark:hidden"></i>
                        <i class="fas fa-sun hidden dark:block"></i>
                    </button>
                    
                    <!-- Refresh Button -->
                    <button @click="refreshSystemStatus()" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 transition-all duration-200">
                        <i class="fas fa-sync-alt" :class="{ 'animate-spin': systemStatus === 'checking' }"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Dashboard -->
    <div class="flex flex-col lg:flex-row h-screen p-2 sm:p-4 gap-2 sm:gap-4">
        <!-- Left Panel: File Explorer -->
        <div class="w-full lg:w-1/3 panel rounded-xl shadow-xl order-2 lg:order-1">
            <div class="p-6 border-b border-gray-200/50 dark:border-gray-700/50">
                <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center mb-4">
                    <i class="fas fa-brain mr-3 text-primary-500"></i>
                    Knowledge Hub
                </h2>
                <div class="flex flex-wrap gap-2">
                    <button @click="refreshFiles()" class="px-3 py-2 text-xs bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 rounded-lg hover:bg-primary-200 dark:hover:bg-primary-900/50 transition-all duration-200 flex items-center">
                        <i class="fas fa-sync-alt mr-1"></i>Refresh
                    </button>
                    <button @click="showUploadModal = true" class="px-3 py-2 text-xs bg-accent-100 dark:bg-accent-900/30 text-accent-700 dark:text-accent-300 rounded-lg hover:bg-accent-200 dark:hover:bg-accent-900/50 transition-all duration-200 flex items-center">
                        <i class="fas fa-upload mr-1"></i>Upload
                    </button>
                    <button @click="showMemoryManager = true" class="px-3 py-2 text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded-lg hover:bg-purple-200 dark:hover:bg-purple-900/50 transition-all duration-200 flex items-center">
                        <i class="fas fa-memory mr-1"></i>Memory
                    </button>
                    <button @click="showToolManager = true" class="px-3 py-2 text-xs bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 rounded-lg hover:bg-orange-200 dark:hover:bg-orange-900/50 transition-all duration-200 flex items-center">
                        <i class="fas fa-tools mr-1"></i>Tools
                    </button>
                    <button @click="showConnectionsModal = true" class="px-3 py-2 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-all duration-200 flex items-center">
                        <i class="fas fa-plug mr-1"></i>Connections
                    </button>
                    <button @click="showCodeEditor = true" class="px-3 py-2 text-xs bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded-lg hover:bg-indigo-200 dark:hover:bg-indigo-900/50 transition-all duration-200 flex items-center">
                        <i class="fas fa-code mr-1"></i>Code Editor
                    </button>
                    <button @click="showIntegrationsManager = true" class="px-3 py-2 text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-lg hover:bg-green-200 dark:hover:bg-green-900/50 transition-all duration-200 flex items-center">
                        <i class="fas fa-link mr-1"></i>Integrations
                    </button>
                    <button @click="showThemeManager = true" class="px-3 py-2 text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 rounded-lg hover:bg-purple-200 dark:hover:bg-purple-900/50 transition-all duration-200 flex items-center">
                        <i class="fas fa-palette mr-1"></i>Themes
                    </button>
                </div>
            </div>
            
            <div class="p-4">
                <!-- Memory Usage -->
                <div class="mb-4 p-3 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Memory Usage</span>
                        <span class="text-xs text-gray-500 dark:text-gray-400" x-text="memoryUsage + '%'"></span>
                    </div>
                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                        <div class="bg-gradient-to-r from-purple-500 to-blue-500 h-2 rounded-full transition-all duration-300" :style="'width: ' + memoryUsage + '%'"></div>
                    </div>
                    <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                        <span x-text="memoryStats.used"></span> / <span x-text="memoryStats.total"></span> documents
                    </div>
                </div>

                <!-- File Sources with Selection -->
                <div class="mb-4">
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Knowledge Sources</span>
                        <button @click="selectAllFiles()" class="text-xs text-primary-600 dark:text-primary-400 hover:underline">
                            Select All
                        </button>
                    </div>
                    <div class="space-y-2">
                        <div class="flex items-center justify-between p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                            <div class="flex items-center">
                                <input type="checkbox" class="mr-3 text-blue-600 focus:ring-blue-500" x-model="selectedSources.dropbox">
                                <i class="fab fa-dropbox text-blue-600 mr-2"></i>
                                <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Dropbox</span>
                            </div>
                            <div class="text-right">
                                <span class="text-xs text-gray-500 dark:text-gray-400">15 files</span>
                                <div class="text-xs text-blue-600 dark:text-blue-400" x-show="selectedSources.dropbox">Selected</div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800">
                            <div class="flex items-center">
                                <input type="checkbox" class="mr-3 text-green-600 focus:ring-green-500" x-model="selectedSources.googleDrive">
                                <i class="fab fa-google-drive text-green-600 mr-2"></i>
                                <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Google Drive</span>
                            </div>
                            <div class="text-right">
                                <span class="text-xs text-gray-500 dark:text-gray-400">8 files</span>
                                <div class="text-xs text-green-600 dark:text-green-400" x-show="selectedSources.googleDrive">Selected</div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800">
                            <div class="flex items-center">
                                <input type="checkbox" class="mr-3 text-purple-600 focus:ring-purple-500" x-model="selectedSources.notion">
                                <i class="fas fa-cloud text-purple-600 mr-2"></i>
                                <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Notion</span>
                            </div>
                            <div class="text-right">
                                <span class="text-xs text-gray-500 dark:text-gray-400">3 docs</span>
                                <div class="text-xs text-purple-600 dark:text-purple-400" x-show="selectedSources.notion">Selected</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ingestion Controls -->
                <div class="mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Ingestion Queue</span>
                        <span class="text-xs text-gray-500 dark:text-gray-400" x-text="selectedSourcesCount + ' selected'"></span>
                    </div>
                    <div class="flex space-x-2">
                        <button @click="startIngestion()" class="flex-1 px-3 py-2 text-xs bg-accent-500 text-white rounded-lg hover:bg-accent-600 transition-all duration-200 flex items-center justify-center" :disabled="selectedSourcesCount === 0">
                            <i class="fas fa-play mr-1"></i>Ingest Selected
                        </button>
                        <button @click="clearQueue()" class="px-3 py-2 text-xs bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all duration-200">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>

                <!-- Recent Files -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Recent Files</span>
                    </div>
                    <div class="space-y-1">
                        <template x-for="file in recentFiles" :key="file.name">
                            <div class="file-item p-2 rounded cursor-pointer" @click="selectFile(file)">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <i :class="getFileIcon(file.type)" class="mr-2 text-gray-500"></i>
                                        <span class="text-sm" x-text="file.name"></span>
                                    </div>
                                    <span class="text-xs text-gray-400" x-text="file.size"></span>
                                </div>
                                <div class="text-xs text-gray-400 mt-1" x-text="file.modified"></div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="mt-6">
                    <div class="text-sm font-medium text-gray-700 mb-2">Quick Actions</div>
                    <div class="space-y-2">
                        <button @click="startPipeline('design-to-shopify')" class="w-full p-2 text-left text-sm bg-blue-50 hover:bg-blue-100 rounded transition-colors">
                            <i class="fas fa-magic mr-2 text-blue-600"></i>
                            Design â†’ Shopify
                        </button>
                        <button @click="startPipeline('content-creation')" class="w-full p-2 text-left text-sm bg-green-50 hover:bg-green-100 rounded transition-colors">
                            <i class="fas fa-pen-fancy mr-2 text-green-600"></i>
                            Content Creation
                        </button>
                        <button @click="organizeFiles()" class="w-full p-2 text-left text-sm bg-purple-50 hover:bg-purple-100 rounded transition-colors">
                            <i class="fas fa-sort-alpha-down mr-2 text-purple-600"></i>
                            Organize Files
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Middle Panel: Chat with Brebot -->
        <div class="w-full lg:w-1/3 panel rounded-xl shadow-xl order-1 lg:order-2">
            <div class="p-6 border-b border-gray-200/50 dark:border-gray-700/50">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center">
                        <i class="fas fa-comments mr-3 text-accent-500"></i>
                        Chat with Brebot
                    </h2>
                    <div class="flex items-center space-x-3">
                        <select x-model="selectedBot" class="text-sm border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                            <option value="brebot">Brebot Manager</option>
                            <option value="mocktopus">MockTopus</option>
                            <option value="airtable-logger">Airtable Logger</option>
                            <option value="shopify-publisher">Shopify Publisher</option>
                        </select>
                        <button @click="toggleRAG()" class="p-2 rounded-lg transition-all duration-200" :class="useRAG ? 'bg-accent-100 dark:bg-accent-900/30 text-accent-600 dark:text-accent-400' : 'bg-gray-100 dark:bg-gray-800 text-gray-400 dark:text-gray-500'">
                            <i class="fas fa-brain"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chat Messages -->
            <div class="flex-1 p-6 overflow-y-auto" style="height: calc(100vh - 200px);">
                <div class="space-y-4">
                    <template x-for="message in chatMessages" :key="message.id">
                        <div class="chat-message animate-slide-up" :class="message.sender === 'user' ? 'flex justify-end' : 'flex justify-start'">
                            <div class="max-w-xs lg:max-w-md px-4 py-3 rounded-2xl shadow-sm" 
                                 :class="message.sender === 'user' ? 'bg-gradient-to-r from-primary-500 to-primary-600 text-white' : 'bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100'">
                                <div class="text-sm leading-relaxed" x-text="message.text"></div>
                                <div class="text-xs opacity-70 mt-2" x-text="message.timestamp"></div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Chat Input -->
            <div class="p-6 border-t border-gray-200/50 dark:border-gray-700/50">
                <div class="flex space-x-3">
                    <input 
                        x-model="chatInput" 
                        @keydown.enter="sendMessage()"
                        type="text" 
                        placeholder="Ask Brebot anything..."
                        class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-200"
                    >
                    <button @click="sendMessage()" class="px-6 py-3 bg-gradient-to-r from-primary-500 to-primary-600 text-white rounded-xl hover:from-primary-600 hover:to-primary-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="mt-3 text-xs text-gray-500 dark:text-gray-400 flex items-center">
                    <i class="fas fa-info-circle mr-1"></i>
                    <span x-text="useRAG ? 'RAG enabled - using knowledge base' : 'Direct chat mode'"></span>
                </div>
            </div>
        </div>

        <!-- Right Panel: Bot Organization -->
        <div class="w-full lg:w-1/3 panel rounded-xl shadow-xl order-3">
            <div class="p-6 border-b border-gray-200/50 dark:border-gray-700/50">
                <div class="flex items-center justify-between mb-3">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center">
                        <i class="fas fa-sitemap mr-3 text-purple-500"></i>
                        Bot Organization
                    </h2>
                    <div class="flex items-center space-x-2">
                        <button @click="openBotArchitect()" class="px-3 py-1 text-xs bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-all duration-200 flex items-center">
                            <i class="fas fa-magic mr-1"></i>Bot Architect
                        </button>
                        <button @click="showCreateBotModal = true" class="px-3 py-1 text-xs bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-all duration-200 flex items-center">
                            <i class="fas fa-plus mr-1"></i>New Bot
                        </button>
                    </div>
                </div>
                <div class="text-sm text-gray-500 dark:text-gray-400">
                    <span class="font-semibold text-accent-600 dark:text-accent-400" x-text="onlineBots"></span> online, 
                    <span class="font-semibold text-yellow-600 dark:text-yellow-400" x-text="busyBots"></span> busy
                </div>
            </div>

            <div class="p-6">
                <!-- Bot Hierarchy Tree -->
                <div class="space-y-2">
                    <template x-for="department in botHierarchy" :key="department.name">
                        <div class="department-node">
                            <!-- Department Header -->
                            <div class="flex items-center justify-between p-3 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg cursor-pointer" 
                                 @click="toggleDepartment(department.name)">
                                <div class="flex items-center">
                                    <i class="fas fa-chevron-right mr-2 text-gray-500 transition-transform duration-200" 
                                       :class="department.expanded ? 'rotate-90' : ''"></i>
                                    <i :class="department.icon" class="mr-2 text-purple-600"></i>
                                    <span class="font-semibold text-sm text-gray-900 dark:text-gray-100" x-text="department.name"></span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs text-gray-500 dark:text-gray-400" x-text="department.bots.length + ' bots'"></span>
                                    <span class="w-2 h-2 rounded-full" :class="department.status === 'healthy' ? 'bg-accent-500' : 'bg-yellow-500'"></span>
                                </div>
                            </div>
                            
                            <!-- Bot Nodes -->
                            <div x-show="department.expanded" class="ml-6 mt-2 space-y-2">
                                <template x-for="bot in department.bots" :key="bot.bot_id">
                                    <div class="bot-node p-3 border border-gray-200/50 dark:border-gray-700/50 rounded-lg cursor-pointer transition-all duration-200 hover:shadow-md" 
                                         @click="selectBotNode(bot)"
                                         :class="selectedBotId === bot.bot_id ? 'border-primary-500 bg-primary-50 dark:bg-primary-900/20 shadow-lg' : ''">
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center">
                                                <span class="status-indicator" :class="'status-' + bot.status"></span>
                                                <span class="font-medium text-sm text-gray-900 dark:text-gray-100" x-text="bot.bot_id"></span>
                                            </div>
                                            <button @click.stop="editBot(bot)" class="p-1 text-gray-400 hover:text-primary-600 transition-colors">
                                                <i class="fas fa-edit text-xs"></i>
                                            </button>
                                        </div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400 mb-2" x-text="bot.description"></div>
                                        <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400">
                                            <span>Tasks: <span class="font-semibold" x-text="bot.tasks_completed"></span></span>
                                            <span>Health: <span class="font-semibold" x-text="bot.health_score + '%'"></span></span>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Current Tasks -->
                <div class="mt-6">
                    <div class="text-sm font-medium text-gray-700 mb-2">Current Tasks</div>
                    <div class="space-y-2">
                        <template x-for="task in activeTasks" :key="task.task_id">
                            <div class="p-2 bg-gray-50 rounded text-xs">
                                <div class="flex justify-between items-center">
                                    <span class="font-medium" x-text="task.bot_id"></span>
                                    <span class="text-gray-500" x-text="task.progress + '%'"></span>
                                </div>
                                <div class="text-gray-600 mt-1" x-text="task.message"></div>
                                <div class="w-full bg-gray-200 rounded-full h-1 mt-1">
                                    <div class="bg-blue-600 h-1 rounded-full" :style="'width: ' + task.progress + '%'"></div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Pipeline Status -->
                <div class="mt-6">
                    <div class="text-sm font-medium text-gray-700 mb-2">Active Pipelines</div>
                    <div class="space-y-2">
                        <template x-for="pipeline in activePipelines" :key="pipeline.id">
                            <div class="p-2 bg-gray-50 rounded text-xs">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="font-medium" x-text="pipeline.type"></span>
                                    <span class="text-gray-500" x-text="pipeline.progress + '%'"></span>
                                </div>
                                <div class="text-gray-600 mb-1" x-text="pipeline.current_step"></div>
                                <div class="w-full bg-gray-200 rounded-full h-1">
                                    <div class="bg-green-600 h-1 rounded-full" :style="'width: ' + pipeline.progress + '%'"></div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Setup Overlay -->
    <div x-show="showSetupPanel" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm" x-transition>
        <div class="bg-white dark:bg-gray-900 shadow-2xl rounded-2xl w-full max-w-3xl mx-4 overflow-hidden">
            <div class="flex items-center justify-between px-6 py-4 bg-gradient-to-r from-primary-500 to-accent-500 text-white">
                <div>
                    <h2 class="text-xl font-semibold flex items-center">
                        <i class="fas fa-rocket mr-3"></i>
                        Brebot Power-Up & Ingestion
                    </h2>
                    <p class="text-sm text-white/80">Initialize services and feed Brebot your latest knowledge drops.</p>
                </div>
                <button @click="closeSetupPanel()" class="text-white/80 hover:text-white transition"><i class="fas fa-times text-lg"></i></button>
            </div>

            <div class="p-6 space-y-6 max-h-[80vh] overflow-y-auto">
                <section class="p-5 border border-gray-200 dark:border-gray-700 rounded-xl bg-gray-50/60 dark:bg-gray-800/40">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center">
                                <i class="fas fa-bolt mr-2 text-accent-500"></i>
                                System Power-Up
                            </h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Check services, ensure the workspace exists, and confirm integrations.</p>
                        </div>
                        <button @click="powerUpSystem()" :disabled="powerLoading" class="px-4 py-2 rounded-lg bg-accent-500 text-white font-semibold shadow hover:bg-accent-600 disabled:opacity-60">
                            <span x-show="!powerLoading"><i class="fas fa-play mr-2"></i>Run Power-Up</span>
                            <span x-show="powerLoading" class="flex items-center"><i class="fas fa-spinner animate-spin mr-2"></i>Working...</span>
                        </button>
                    </div>
                    <div x-show="powerStatus" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <template x-for="(value, key) in {workspace: powerStatus.workspace, chroma: powerStatus.chroma, redis: powerStatus.redis, airtable: powerStatus.airtable}" :key="key">
                            <div class="p-3 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 flex items-start">
                                <div class="w-2 h-2 rounded-full mt-1 mr-3" :class="{
                                    'bg-green-500': value?.status === 'ready',
                                    'bg-yellow-400': value?.status === 'warning' || value?.status === 'unknown',
                                    'bg-red-500': value?.status === 'error' || value?.status === 'not_configured'
                                }"></div>
                                <div>
                                    <div class="text-sm font-medium text-gray-800 dark:text-gray-200 capitalize" x-text="key"></div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400" x-text="value?.status || 'n/a'"></div>
                                    <div class="text-xs text-red-500" x-show="value?.message" x-text="value.message"></div>
                                </div>
                            </div>
                        </template>
                    </div>
                </section>

                <section class="p-5 border border-gray-200 dark:border-gray-700 rounded-xl bg-gray-50/60 dark:bg-gray-800/40" @dragover.prevent="handleDragOver" @dragleave.prevent="handleDragLeave" @drop="handleDrop($event)">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center">
                                <i class="fas fa-cloud-upload-alt mr-2 text-primary-500"></i>
                                Knowledge Drop Zone
                            </h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Drag & drop exports or click to browse. Brebot auto-routes based on keywords.</p>
                        </div>
                        <div class="flex space-x-2">
                            <button @click="$refs.ingestFileInput.click()" class="px-3 py-2 text-xs rounded-lg bg-primary-500 text-white hover:bg-primary-600 transition">Browse Files</button>
                            <button @click="triggerIngestion(false)" :disabled="ingestionLoading" class="px-3 py-2 text-xs rounded-lg bg-accent-500 text-white hover:bg-accent-600 transition disabled:opacity-60">
                                <span x-show="!ingestionLoading"><i class="fas fa-play mr-1"></i>Start Ingestion</span>
                                <span x-show="ingestionLoading"><i class="fas fa-spinner animate-spin mr-2"></i>Starting...</span>
                            </button>
                            <button @click="triggerIngestion(true)" class="px-3 py-2 text-xs rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                                <i class="fas fa-eye mr-1"></i>Dry Run
                            </button>
                        </div>
                    </div>

                    <div :class="dropActive ? 'border-primary-400 bg-primary-50 dark:bg-primary-900/20' : 'border-dashed border-gray-300 dark:border-gray-600'" class="border-2 rounded-xl p-6 text-center transition-all duration-200">
                        <div class="flex flex-col items-center text-gray-500 dark:text-gray-400">
                            <i class="fas fa-cloud-upload-alt text-3xl mb-3"></i>
                            <p class="text-sm">Drop files here or click <span class="text-primary-500 dark:text-primary-300">Browse Files</span></p>
                            <p class="text-xs mt-1">Supported: .txt, .md, .json, .csv</p>
                            <p class="text-xs mt-2 text-gray-400">Files land in Inbox/ingest, then archive to Inbox/processed after ingestion.</p>
                        </div>
                        <input type="file" multiple class="hidden" x-ref="ingestFileInput" @change="uploadIngestionFilesFromInput">
                    </div>
                </section>

                <section class="p-5 border border-gray-200 dark:border-gray-700 rounded-xl bg-white dark:bg-gray-900/60">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center">
                            <i class="fas fa-list mr-2 text-primary-500"></i>
                            Recent Ingestion Runs
                        </h3>
                        <button @click="fetchIngestionHistory" class="text-xs text-primary-500 hover:underline"><i class="fas fa-sync-alt mr-1"></i>Refresh</button>
                    </div>
                    <div x-show="ingestionHistory.length === 0" class="text-sm text-gray-500 dark:text-gray-400">No ingestion runs yet. Drop some files to get started!</div>
                    <div class="space-y-3" x-show="ingestionHistory.length > 0">
                        <template x-for="run in ingestionHistory" :key="run.run_id">
                            <div class="p-4 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-800/60">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="text-sm font-semibold text-gray-900 dark:text-gray-100" x-text="run.run_id"></div>
                                        <div class="text-xs text-gray-500 dark:text-gray-400" x-text="new Date(run.timestamp).toLocaleString()"></div>
                                    </div>
                                    <span class="px-2 py-1 rounded-full text-xs font-medium" :class="{
                                        'bg-green-100 text-green-700': run.status === 'success',
                                        'bg-yellow-100 text-yellow-700': run.status === 'mixed' || run.status === 'not_found',
                                        'bg-red-100 text-red-700': run.status === 'failed',
                                        'bg-gray-100 text-gray-600': run.dry_run
                                    }" x-text="run.dry_run ? 'dry run' : run.status"></span>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-2 mt-3 text-xs text-gray-600 dark:text-gray-300">
                                    <div>Domain: <span class="font-semibold" x-text="run.domain || 'â€”'"></span></div>
                                    <div>Project: <span class="font-semibold" x-text="run.project || 'â€”'"></span></div>
                                    <div>Chunks: <span class="font-semibold" x-text="run.chunks"></span></div>
                                </div>
                                <div class="text-xs text-gray-500 dark:text-gray-400 mt-2">Files processed: <span x-text="run.files_processed"></span></div>
                            </div>
                        </template>
                    </div>
                </section>
            </div>
        </div>
    </div>
    <!-- Upload Modal -->
    <div x-show="showUploadModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-6 w-96">
            <h3 class="text-lg font-semibold mb-4">Upload File</h3>
            <div class="space-y-4">
                <input type="file" class="w-full p-2 border border-gray-300 rounded">
                <div class="flex justify-end space-x-2">
                    <button @click="showUploadModal = false" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
                    <button @click="uploadFile()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Upload</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Memory Management Modal -->
    <div x-show="showMemoryManager" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" x-transition>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">
                        <i class="fas fa-memory mr-2 text-purple-500"></i>
                        Memory Management
                    </h3>
                    <button @click="showMemoryManager = false" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <!-- Memory Statistics -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                        <div class="text-sm text-blue-600 dark:text-blue-400 font-medium">Total Documents</div>
                        <div class="text-2xl font-bold text-blue-700 dark:text-blue-300" x-text="memoryStats.total"></div>
                    </div>
                    <div class="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
                        <div class="text-sm text-green-600 dark:text-green-400 font-medium">Indexed</div>
                        <div class="text-2xl font-bold text-green-700 dark:text-green-300" x-text="memoryStats.indexed"></div>
                    </div>
                </div>
                
                <!-- Memory Actions -->
                <div class="space-y-4">
                    <div class="flex space-x-3">
                        <button @click="optimizeMemory()" class="flex-1 px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors">
                            <i class="fas fa-compress mr-2"></i>Optimize Memory
                        </button>
                        <button @click="clearMemory()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                            <i class="fas fa-trash mr-2"></i>Clear All
                        </button>
                    </div>
                    
                    <!-- Memory Categories -->
                    <div class="space-y-2">
                        <h4 class="font-medium text-gray-900 dark:text-gray-100">Memory Categories</h4>
                        <template x-for="category in memoryCategories" :key="category.name">
                            <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                <div class="flex items-center">
                                    <i :class="category.icon" class="mr-3 text-gray-600"></i>
                                    <span class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="category.name"></span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs text-gray-500 dark:text-gray-400" x-text="category.count + ' docs'"></span>
                                    <button @click="clearCategory(category.name)" class="text-red-500 hover:text-red-700">
                                        <i class="fas fa-trash text-xs"></i>
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bot Editor Modal -->
    <div x-show="showBotEditor" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" x-transition>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-3xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">
                        <i class="fas fa-edit mr-2 text-primary-500"></i>
                        Edit Bot: <span x-text="editingBot?.bot_id"></span>
                    </h3>
                    <button @click="showBotEditor = false" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Bot Details -->
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Bot Name</label>
                            <input x-model="editingBot.bot_id" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Description</label>
                            <textarea x-model="editingBot.description" rows="3" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Responsibilities</label>
                            <textarea x-model="editingBot.responsibilities" rows="4" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"></textarea>
                        </div>
                    </div>
                    
                    <!-- Bot Image & Settings -->
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Bot Avatar</label>
                            <div class="flex items-center space-x-4">
                                <div class="w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center">
                                    <img x-show="editingBot.avatar" :src="editingBot.avatar" class="w-full h-full object-cover rounded-lg">
                                    <i x-show="!editingBot.avatar" class="fas fa-robot text-gray-400"></i>
                                </div>
                                <button @click="uploadBotAvatar()" class="px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors">
                                    <i class="fas fa-upload mr-2"></i>Upload Image
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Status</label>
                            <select x-model="editingBot.status" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                <option value="online">Online</option>
                                <option value="busy">Busy</option>
                                <option value="offline">Offline</option>
                                <option value="error">Error</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Health Score</label>
                            <input type="range" x-model="editingBot.health_score" min="0" max="100" class="w-full">
                            <div class="text-sm text-gray-500 dark:text-gray-400" x-text="editingBot.health_score + '%'"></div>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <button @click="showBotEditor = false" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">
                        Cancel
                    </button>
                    <button @click="saveBot()" class="px-6 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors">
                        <i class="fas fa-save mr-2"></i>Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Bot Modal -->
    <div x-show="showCreateBotModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" x-transition>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">
                        <i class="fas fa-plus mr-2 text-primary-500"></i>
                        Create New Bot
                    </h3>
                    <button @click="showCreateBotModal = false" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Bot Configuration -->
                    <div class="space-y-4">
                        <h4 class="font-medium text-gray-900 dark:text-gray-100 mb-4">Bot Configuration</h4>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Bot Name *</label>
                            <input x-model="newBot.bot_id" placeholder="e.g., content-writer" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Department *</label>
                            <select x-model="newBot.department" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                <option value="">Select Department</option>
                                <option value="Content Creation">Content Creation</option>
                                <option value="Data Management">Data Management</option>
                                <option value="E-commerce">E-commerce</option>
                                <option value="Marketing">Marketing</option>
                                <option value="Customer Service">Customer Service</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Bot Type *</label>
                            <select x-model="newBot.bot_type" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                <option value="">Select Type</option>
                                <option value="text_processing">Text Processing</option>
                                <option value="image_processing">Image Processing</option>
                                <option value="data_processing">Data Processing</option>
                                <option value="web_scraping">Web Scraping</option>
                                <option value="api_integration">API Integration</option>
                                <option value="file_management">File Management</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Description *</label>
                            <textarea x-model="newBot.description" rows="3" placeholder="Brief description of what this bot does..." class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Responsibilities</label>
                            <textarea x-model="newBot.responsibilities" rows="4" placeholder="Detailed list of bot responsibilities and capabilities..." class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Initial Status</label>
                            <select x-model="newBot.status" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                <option value="online">Online</option>
                                <option value="offline">Offline</option>
                            </select>
                        </div>
                        
                        <!-- Voice Configuration -->
                        <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                            <h5 class="font-medium text-gray-900 dark:text-gray-100 mb-3">Voice Configuration</h5>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Voice Provider</label>
                                    <select x-model="newBot.voice.provider" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                        <option value="openai">OpenAI</option>
                                        <option value="elevenlabs">ElevenLabs</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Voice ID</label>
                                    <select x-model="newBot.voice.voice_id" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                                        <template x-if="newBot.voice.provider === 'openai'">
                                            <div>
                                                <option value="alloy">Alloy</option>
                                                <option value="echo">Echo</option>
                                                <option value="fable">Fable</option>
                                                <option value="onyx">Onyx</option>
                                                <option value="nova">Nova</option>
                                                <option value="shimmer">Shimmer</option>
                                            </div>
                                        </template>
                                        <template x-if="newBot.voice.provider === 'elevenlabs'">
                                            <div>
                                                <option value="21m00Tcm4TlvDq8ikWAM">Rachel</option>
                                                <option value="AZnzlk1XvdvUeBnXmlld">Domi</option>
                                                <option value="EXAVITQu4vr4xnSDxMaL">Bella</option>
                                                <option value="ErXwobaYiN019PkySvjV">Antoni</option>
                                                <option value="MF3mGyEYCl7XYWbV9V6O">Elli</option>
                                                <option value="TxGEqnHWrfWFTfGW9XjX">Josh</option>
                                                <option value="VR6AewLTigWG4xSOukaG">Arnold</option>
                                                <option value="pNInz6obpgDQGcFmaJgB">Adam</option>
                                                <option value="yoZ06aMxZJJ28mfd3POQ">Sam</option>
                                            </div>
                                        </template>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4 mt-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Speed: <span x-text="newBot.voice.speed"></span></label>
                                    <input type="range" x-model="newBot.voice.speed" min="0.5" max="2.0" step="0.1" class="w-full">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Pitch: <span x-text="newBot.voice.pitch"></span></label>
                                    <input type="range" x-model="newBot.voice.pitch" min="0.5" max="2.0" step="0.1" class="w-full">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tool Selection -->
                    <div class="space-y-4">
                        <h4 class="font-medium text-gray-900 dark:text-gray-100 mb-4">Available Tools</h4>
                        
                        <!-- Tool Categories -->
                        <div class="space-y-3">
                            <template x-for="category in toolCategories" :key="category.name">
                                <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-3">
                                    <div class="flex items-center justify-between mb-2">
                                        <h5 class="font-medium text-gray-900 dark:text-gray-100" x-text="category.name"></h5>
                                        <button @click="toggleToolCategory(category.name)" class="text-xs text-primary-600 dark:text-primary-400">
                                            <span x-text="category.expanded ? 'Collapse' : 'Expand'"></span>
                                        </button>
                                    </div>
                                    <div x-show="category.expanded" class="space-y-2">
                                        <template x-for="tool in category.tools" :key="tool.name">
                                            <label class="flex items-center p-2 hover:bg-gray-50 dark:hover:bg-gray-700 rounded cursor-pointer">
                                                <input type="checkbox" :value="tool.name" x-model="newBot.selectedTools" class="mr-3 text-primary-600 focus:ring-primary-500">
                                                <div class="flex-1">
                                                    <div class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="tool.name"></div>
                                                    <div class="text-xs text-gray-500 dark:text-gray-400" x-text="tool.description"></div>
                                                </div>
                                                <div class="text-xs text-gray-400" x-text="tool.type"></div>
                                            </label>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>
                        
                        <!-- Selected Tools Summary -->
                        <div class="mt-4 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg">
                            <h5 class="font-medium text-primary-900 dark:text-primary-100 mb-2">Selected Tools</h5>
                            <div class="text-sm text-primary-700 dark:text-primary-300">
                                <span x-text="newBot.selectedTools.length"></span> tools selected
                            </div>
                            <div x-show="newBot.selectedTools.length > 0" class="mt-2">
                                <template x-for="tool in newBot.selectedTools" :key="tool">
                                    <span class="inline-block bg-primary-100 dark:bg-primary-800 text-primary-800 dark:text-primary-200 text-xs px-2 py-1 rounded mr-1 mb-1" x-text="tool"></span>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <button @click="showCreateBotModal = false" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">
                        Cancel
                    </button>
                    <button @click="createBot()" class="px-6 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors">
                        <i class="fas fa-plus mr-2"></i>Create Bot
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bot Architect Modal -->
    <div x-show="showBotArchitectModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" x-transition>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-5xl w-full mx-4 max-h-[92vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">
                        <i class="fas fa-hat-wizard mr-2 text-purple-500"></i>
                        Bot Architect
                    </h3>
                    <button @click="closeBotArchitect" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Describe the bot you need and Brebot will suggest a configuration, tools, and setup checklist. You can create it instantly or refine the blueprint first.</p>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <h4 class="font-medium text-gray-900 dark:text-gray-100">Bot Brief</h4>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Bot Name</label>
                            <input x-model="botArchitectForm.name" placeholder="Optional friendly name" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Primary Goal *</label>
                            <textarea x-model="botArchitectForm.goal" rows="2" placeholder="Explain what the bot should achieve" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Context</label>
                            <textarea x-model="botArchitectForm.description" rows="3" placeholder="Any additional background or constraints" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"></textarea>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Key Tasks</label>
                                <textarea x-model="botArchitectForm.primary_tasks" rows="4" placeholder="One per line or comma separated" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Data Sources</label>
                                <textarea x-model="botArchitectForm.data_sources" rows="4" placeholder="e.g., Dropbox, Notion, Airtable" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"></textarea>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Integrations</label>
                                <textarea x-model="botArchitectForm.integrations" rows="3" placeholder="Tools, APIs, automations" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Success Metrics</label>
                                <textarea x-model="botArchitectForm.success_metrics" rows="3" placeholder="How you\'ll measure success" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"></textarea>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Personality & Tone</label>
                            <input x-model="botArchitectForm.personality" placeholder="e.g., Friendly project manager" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                        </div>
                        <div class="flex items-center space-x-2">
                            <input id="architect-auto-create" type="checkbox" x-model="botArchitectForm.auto_create" class="rounded border-gray-300 text-primary-600 focus:ring-primary-500">
                            <label for="architect-auto-create" class="text-sm text-gray-600 dark:text-gray-400">Create the bot automatically after generating the blueprint</label>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <h4 class="font-medium text-gray-900 dark:text-gray-100">Blueprint</h4>
                        <div class="p-4 rounded-lg border border-dashed border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-900/30" x-show="!botArchitectResult">
                            <p class="text-sm text-gray-500 dark:text-gray-400" x-show="!botArchitectLoading">Fill out the brief and click "Generate Blueprint" to preview the recommended configuration.</p>
                            <div class="flex items-center space-x-2 text-primary-600" x-show="botArchitectLoading">
                                <i class="fas fa-spinner animate-spin"></i>
                                <span class="text-sm">Summoning the bot architect...</span>
                            </div>
                        </div>
                        <div x-show="botArchitectResult" class="space-y-4">
                            <div class="p-4 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900/40 shadow-sm">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h5 class="text-md font-semibold text-gray-900 dark:text-gray-100" x-text="botArchitectResult.recommendation.name || botArchitectResult.recommendation.bot_id"></h5>
                                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1" x-text="botArchitectResult.recommendation.department + ' â€¢ ' + botArchitectResult.recommendation.bot_type"></p>
                                    </div>
                                    <span class="px-2 py-1 text-xs rounded-full bg-primary-100 text-primary-700" x-text="botArchitectResult.status === 'draft' ? 'Blueprint' : 'Created'"></span>
                                </div>
                                <p class="mt-3 text-sm text-gray-600 dark:text-gray-300" x-text="botArchitectResult.recommendation.description"></p>
                                <div class="mt-4">
                                    <h6 class="text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-400">Responsibilities</h6>
                                    <ul class="mt-2 space-y-1 text-sm text-gray-600 dark:text-gray-300">
                                        <template x-for="task in botArchitectResult.recommendation.responsibilities" :key="task">
                                            <li><i class="fas fa-check text-primary-500 mr-2"></i><span x-text="task"></span></li>
                                        </template>
                                    </ul>
                                </div>
                                <div class="mt-4">
                                    <h6 class="text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-400">Suggested Tools</h6>
                                    <div class="mt-2 flex flex-wrap gap-2">
                                        <template x-for="tool in botArchitectResult.recommendation.suggested_tools" :key="tool">
                                            <span class="px-2 py-1 text-xs bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-200 rounded-full" x-text="tool"></span>
                                        </template>
                                    </div>
                                </div>
                                <div class="mt-4" x-show="botArchitectResult.checklist?.length">
                                    <h6 class="text-xs font-semibold uppercase tracking-wide text-gray-500 dark:text-gray-400">Setup Checklist</h6>
                                    <ul class="mt-2 space-y-1 text-sm text-gray-600 dark:text-gray-300">
                                        <template x-for="item in botArchitectResult.checklist" :key="item">
                                            <li><i class="fas fa-list-check text-green-500 mr-2"></i><span x-text="item"></span></li>
                                        </template>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-3">
                            <button @click="submitBotArchitect(false)" :disabled="botArchitectLoading" class="px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors disabled:opacity-60">
                                <span x-show="!botArchitectLoading"><i class="fas fa-lightbulb mr-2"></i>Generate Blueprint</span>
                                <span x-show="botArchitectLoading"><i class="fas fa-spinner animate-spin mr-2"></i>Working...</span>
                            </button>
                            <button @click="submitBotArchitect(true)" :disabled="botArchitectLoading" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors disabled:opacity-60">
                                <i class="fas fa-robot mr-2"></i>Generate & Create Bot
                            </button>
                            <button @click="resetBotArchitectForm" class="px-3 py-2 text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">Reset</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tool Manager Modal -->
    <div x-show="showToolManager" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" x-transition>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-5xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">
                        <i class="fas fa-tools mr-2 text-orange-500"></i>
                        Tool Management
                    </h3>
                    <button @click="showToolManager = false" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <!-- Tool Statistics -->
                <div class="grid grid-cols-4 gap-4 mb-6">
                    <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                        <div class="text-sm text-blue-600 dark:text-blue-400 font-medium">Total Tools</div>
                        <div class="text-2xl font-bold text-blue-700 dark:text-blue-300" x-text="getTotalTools()"></div>
                    </div>
                    <div class="p-4 bg-green-50 dark:bg-green-900/20 rounded-lg">
                        <div class="text-sm text-green-600 dark:text-green-400 font-medium">Active Tools</div>
                        <div class="text-2xl font-bold text-green-700 dark:text-green-300" x-text="getActiveTools()"></div>
                    </div>
                    <div class="p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                        <div class="text-sm text-purple-600 dark:text-purple-400 font-medium">Categories</div>
                        <div class="text-2xl font-bold text-purple-700 dark:text-purple-300" x-text="toolCategories.length"></div>
                    </div>
                    <div class="p-4 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
                        <div class="text-sm text-orange-600 dark:text-orange-400 font-medium">In Use</div>
                        <div class="text-2xl font-bold text-orange-700 dark:text-orange-300" x-text="getToolsInUse()"></div>
                    </div>
                </div>
                
                <!-- Tool Categories -->
                <div class="space-y-4">
                    <h4 class="font-medium text-gray-900 dark:text-gray-100">Tool Categories</h4>
                    <template x-for="category in toolCategories" :key="category.name">
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg">
                            <div class="p-4 bg-gray-50 dark:bg-gray-700 rounded-t-lg">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center">
                                        <i :class="getCategoryIcon(category.name)" class="mr-3 text-gray-600"></i>
                                        <h5 class="font-medium text-gray-900 dark:text-gray-100" x-text="category.name"></h5>
                                        <span class="ml-2 text-sm text-gray-500 dark:text-gray-400" x-text="category.tools.length + ' tools'"></span>
                                    </div>
                                    <button @click="toggleToolCategory(category.name)" class="text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-200">
                                        <i class="fas fa-chevron-down transition-transform duration-200" :class="category.expanded ? 'rotate-180' : ''"></i>
                                    </button>
                                </div>
                            </div>
                            <div x-show="category.expanded" class="p-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <template x-for="tool in category.tools" :key="tool.name">
                                        <div class="flex items-center justify-between p-3 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg">
                                            <div class="flex-1">
                                                <div class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="tool.name"></div>
                                                <div class="text-xs text-gray-500 dark:text-gray-400" x-text="tool.description"></div>
                                                <div class="text-xs text-gray-400 mt-1">
                                                    Type: <span class="font-medium" x-text="tool.type"></span>
                                                </div>
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <span class="text-xs px-2 py-1 rounded-full" 
                                                      :class="getToolStatusClass(tool.name)"
                                                      x-text="getToolStatus(tool.name)"></span>
                                                <button @click="toggleToolStatus(tool.name)" class="p-1 text-gray-400 hover:text-primary-600 transition-colors">
                                                    <i class="fas fa-power-off text-xs"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
                
                <!-- Tool Actions -->
                <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <div class="flex space-x-3">
                        <button @click="enableAllTools()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                            <i class="fas fa-check mr-2"></i>Enable All
                        </button>
                        <button @click="disableAllTools()" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                            <i class="fas fa-times mr-2"></i>Disable All
                        </button>
                        <button @click="refreshToolStatus()" class="px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors">
                            <i class="fas fa-sync-alt mr-2"></i>Refresh Status
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Connections Modal -->
    <div x-show="showConnectionsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" x-transition>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">
                        <i class="fas fa-plug mr-2 text-primary-500"></i>
                        External Connections
                    </h3>
                    <button @click="showConnectionsModal = false" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <!-- Connection Statistics -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg p-4 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-100 text-sm">Total Connections</p>
                                <p class="text-2xl font-bold" x-text="connections.length"></p>
                            </div>
                            <i class="fas fa-plug text-2xl text-blue-200"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-lg p-4 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-100 text-sm">Connected</p>
                                <p class="text-2xl font-bold" x-text="connectedCount"></p>
                            </div>
                            <i class="fas fa-check-circle text-2xl text-green-200"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg p-4 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-purple-100 text-sm">Ingestion Enabled</p>
                                <p class="text-2xl font-bold" x-text="ingestionEnabledCount"></p>
                            </div>
                            <i class="fas fa-sync text-2xl text-purple-200"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg p-4 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-orange-100 text-sm">N8N Webhooks</p>
                                <p class="text-2xl font-bold" x-text="webhookCount"></p>
                            </div>
                            <i class="fas fa-project-diagram text-2xl text-orange-200"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Connections Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <template x-for="connection in connections" :key="connection.connection_id">
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6 border border-gray-200 dark:border-gray-600">
                            <!-- Connection Header -->
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 rounded-lg flex items-center justify-center text-white text-xl" 
                                         :style="`background-color: ${connection.metadata.color}`">
                                        <i :class="connection.metadata.icon"></i>
                                    </div>
                                    <div class="ml-3">
                                        <h4 class="font-semibold text-gray-900 dark:text-gray-100" x-text="connection.name"></h4>
                                        <p class="text-sm text-gray-600 dark:text-gray-400" x-text="connection.metadata.description"></p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <!-- Status Indicator -->
                                    <div class="w-3 h-3 rounded-full" :class="{
                                        'bg-green-500': connection.status === 'connected',
                                        'bg-red-500': connection.status === 'disconnected',
                                        'bg-yellow-500': connection.status === 'connecting',
                                        'bg-gray-500': connection.status === 'error'
                                    }"></div>
                                    <span class="text-xs font-medium capitalize" x-text="connection.status"></span>
                                </div>
                            </div>
                            
                            <!-- Connection Details -->
                            <div class="space-y-3 mb-4">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600 dark:text-gray-400">Type:</span>
                                    <span class="font-medium text-gray-900 dark:text-gray-100" x-text="connection.connection_type"></span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-600 dark:text-gray-400">Scopes:</span>
                                    <span class="font-medium text-gray-900 dark:text-gray-100" x-text="connection.scopes.length"></span>
                                </div>
                                <div x-show="connection.last_sync" class="flex justify-between text-sm">
                                    <span class="text-gray-600 dark:text-gray-400">Last Sync:</span>
                                    <span class="font-medium text-gray-900 dark:text-gray-100" x-text="formatDate(connection.last_sync)"></span>
                                </div>
                            </div>
                            
                            <!-- Connection Actions -->
                            <div class="space-y-2">
                                <!-- Connect/Disconnect Button -->
                                <button @click="connection.status === 'connected' ? disconnectConnection(connection.connection_id) : connectConnection(connection.connection_id)"
                                        :class="connection.status === 'connected' ? 'bg-red-500 hover:bg-red-600 text-white' : 'bg-primary-500 hover:bg-primary-600 text-white'"
                                        class="w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                    <i :class="connection.status === 'connected' ? 'fas fa-unlink mr-2' : 'fas fa-link mr-2'"></i>
                                    <span x-text="connection.status === 'connected' ? 'Disconnect' : 'Connect'"></span>
                                </button>
                                
                                <!-- Ingestion Toggle -->
                                <button @click="toggleIngestion(connection.connection_id, !connection.enabled_for_ingestion)"
                                        :class="connection.enabled_for_ingestion ? 'bg-purple-500 hover:bg-purple-600 text-white' : 'bg-gray-300 hover:bg-gray-400 text-gray-700'"
                                        :disabled="connection.status !== 'connected'"
                                        class="w-full px-4 py-2 rounded-lg text-sm font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                    <i class="fas fa-sync mr-2"></i>
                                    <span x-text="connection.enabled_for_ingestion ? 'Disable Ingestion' : 'Enable Ingestion'"></span>
                                </button>
                                
                                <!-- Health Check -->
                                <button @click="checkConnectionHealth(connection.connection_id)"
                                        class="w-full px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium transition-colors">
                                    <i class="fas fa-heartbeat mr-2"></i>
                                    Check Health
                                </button>
                            </div>
                            
                            <!-- N8N Webhook Status -->
                            <div x-show="connection.n8n_webhook_url" class="mt-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                <div class="flex items-center text-sm">
                                    <i class="fas fa-project-diagram text-green-500 mr-2"></i>
                                    <span class="text-green-700 dark:text-green-300">N8N Webhook Active</span>
                                </div>
                                <p class="text-xs text-green-600 dark:text-green-400 mt-1" x-text="connection.n8n_webhook_url"></p>
                            </div>
                            
                            <!-- Error Message -->
                            <div x-show="connection.error_message" class="mt-4 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg">
                                <div class="flex items-center text-sm">
                                    <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                                    <span class="text-red-700 dark:text-red-300">Error</span>
                                </div>
                                <p class="text-xs text-red-600 dark:text-red-400 mt-1" x-text="connection.error_message"></p>
                            </div>
                        </div>
                    </template>
                </div>
                
                <!-- N8N Integration Info -->
                <div class="mt-8 p-6 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 rounded-lg border border-purple-200 dark:border-purple-700">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <i class="fas fa-project-diagram text-2xl text-purple-500"></i>
                        </div>
                        <div class="ml-4">
                            <h4 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2">N8N Automation Integration</h4>
                            <p class="text-gray-600 dark:text-gray-400 mb-4">
                                When you enable ingestion for a connection, Brebot automatically creates N8N webhooks that can trigger automation workflows. 
                                For example: new file in Dropbox â†’ N8N flow â†’ auto-ingest to Brebot memory â†’ send message to Inbox.
                            </p>
                            <div class="flex space-x-4">
                                <a href="http://localhost:5678" target="_blank" class="inline-flex items-center px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg text-sm font-medium transition-colors">
                                    <i class="fas fa-external-link-alt mr-2"></i>
                                    Open N8N
                                </a>
                                <button @click="refreshConnections()" class="inline-flex items-center px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-600 dark:hover:bg-gray-500 text-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium transition-colors">
                                    <i class="fas fa-sync-alt mr-2"></i>
                                    Refresh Status
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Code Editor Modal -->
    <div x-show="showCodeEditor" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" x-transition>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-7xl w-full mx-4 max-h-[95vh] overflow-hidden">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">
                    <i class="fas fa-code mr-2 text-indigo-500"></i>
                    Live Code Editor
                </h3>
                <button @click="showCodeEditor = false" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="flex h-[calc(95vh-80px)]">
                <!-- File Tree -->
                <div class="w-1/4 border-r border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
                    <div class="p-3 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Project Files</span>
                            <button @click="refreshCodeFiles()" class="text-xs px-2 py-1 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 rounded">
                                <i class="fas fa-sync-alt mr-1"></i>Refresh
                            </button>
                        </div>
                    </div>
                    <div class="p-2 overflow-y-auto h-full">
                        <template x-for="file in codeFiles" :key="file.path">
                            <div @click="loadCodeFile(file.path)" 
                                 :class="selectedFile === file.path ? 'bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-300' : 'hover:bg-gray-100 dark:hover:bg-gray-800'"
                                 class="p-2 rounded cursor-pointer text-sm flex items-center transition-colors">
                                <i class="fas fa-file-code mr-2 text-gray-400"></i>
                                <span x-text="file.name" class="truncate"></span>
                            </div>
                        </template>
                    </div>
                </div>
                
                <!-- Editor -->
                <div class="flex-1 flex flex-col">
                    <div class="p-3 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900 flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <span class="text-sm font-medium text-gray-700 dark:text-gray-300" x-text="selectedFile || 'No file selected'"></span>
                            <template x-if="fileModified">
                                <span class="text-xs px-2 py-1 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 rounded">Modified</span>
                            </template>
                        </div>
                        <div class="flex space-x-2">
                            <button @click="saveCurrentFile()" 
                                    :disabled="!selectedFile || !fileModified"
                                    :class="!selectedFile || !fileModified ? 'opacity-50 cursor-not-allowed' : 'hover:bg-green-600'"
                                    class="px-3 py-1 bg-green-500 text-white rounded text-sm">
                                <i class="fas fa-save mr-1"></i>Save
                            </button>
                            <button @click="formatCode()" 
                                    :disabled="!selectedFile"
                                    :class="!selectedFile ? 'opacity-50 cursor-not-allowed' : 'hover:bg-blue-600'"
                                    class="px-3 py-1 bg-blue-500 text-white rounded text-sm">
                                <i class="fas fa-magic mr-1"></i>Format
                            </button>
                        </div>
                    </div>
                    <div id="monaco-editor" class="flex-1"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Integrations Manager Modal -->
    <div x-show="showIntegrationsManager" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" x-transition>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-6xl h-5/6 flex flex-col">
            <!-- Header -->
            <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 flex items-center">
                        <i class="fas fa-link mr-3 text-green-500"></i>
                        Platform Integrations
                    </h2>
                    <p class="text-gray-600 dark:text-gray-400 mt-1">Manage your platform connections and API credentials</p>
                </div>
                <button @click="showIntegrationsManager = false" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <!-- Content -->
            <div class="flex-1 p-6 overflow-auto">
                <!-- Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-green-600 dark:text-green-400">Healthy Platforms</p>
                                <p class="text-2xl font-bold text-green-700 dark:text-green-300" x-text="integrationSummary.healthy || 0"></p>
                            </div>
                            <i class="fas fa-check-circle text-green-500 text-2xl"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-blue-600 dark:text-blue-400">Total Platforms</p>
                                <p class="text-2xl font-bold text-blue-700 dark:text-blue-300" x-text="integrationSummary.total || 0"></p>
                            </div>
                            <i class="fas fa-layer-group text-blue-500 text-2xl"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-purple-50 to-violet-50 dark:from-purple-900/20 dark:to-violet-900/20 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-purple-600 dark:text-purple-400">Enabled</p>
                                <p class="text-2xl font-bold text-purple-700 dark:text-purple-300" x-text="integrationSummary.enabled || 0"></p>
                            </div>
                            <i class="fas fa-toggle-on text-purple-500 text-2xl"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-orange-50 to-amber-50 dark:from-orange-900/20 dark:to-amber-900/20 p-4 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-orange-600 dark:text-orange-400">Activities (24h)</p>
                                <p class="text-2xl font-bold text-orange-700 dark:text-orange-300" x-text="activityCount || 0"></p>
                            </div>
                            <i class="fas fa-chart-line text-orange-500 text-2xl"></i>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-wrap gap-3 mb-6">
                    <button @click="refreshIntegrations()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh Status
                    </button>
                    <button @click="runHealthCheck()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors flex items-center">
                        <i class="fas fa-heart mr-2"></i>Health Check
                    </button>
                    <button @click="exportActivityLogs()" class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors flex items-center">
                        <i class="fas fa-download mr-2"></i>Export Logs
                    </button>
                    <button @click="initializeAllIntegrations()" class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors flex items-center">
                        <i class="fas fa-rocket mr-2"></i>Initialize All
                    </button>
                </div>

                <!-- Platforms Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <template x-for="(platform, key) in integrations" :key="key">
                        <div class="bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 p-6 hover:shadow-lg transition-all duration-200">
                            <!-- Platform Header -->
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 rounded-lg flex items-center justify-center mr-3" 
                                         :class="getPlatformIconBg(key)">
                                        <i :class="getPlatformIcon(key)" class="text-white text-lg"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-gray-900 dark:text-gray-100 capitalize" x-text="key"></h3>
                                        <div class="flex items-center">
                                            <span class="status-indicator mr-1" :class="getHealthStatusClass(platform.health)"></span>
                                            <span class="text-xs text-gray-500 dark:text-gray-400" x-text="platform.health"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button @click="togglePlatform(key, platform)" 
                                            :class="platform.enabled ? 'bg-green-500 hover:bg-green-600' : 'bg-gray-400 hover:bg-gray-500'"
                                            class="w-8 h-4 rounded-full relative transition-colors">
                                        <div :class="platform.enabled ? 'translate-x-4' : 'translate-x-0'" 
                                             class="w-4 h-4 bg-white rounded-full shadow transform transition-transform absolute"></div>
                                    </button>
                                </div>
                            </div>

                            <!-- Platform Details -->
                            <div class="space-y-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">API Key:</span>
                                    <span class="text-sm font-mono" x-text="platform.has_api_key ? 'â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢' : 'Not Set'"></span>
                                </div>
                                <div class="flex justify-between items-center" x-show="platform.last_sync">
                                    <span class="text-sm text-gray-600 dark:text-gray-400">Last Sync:</span>
                                    <span class="text-sm" x-text="formatDate(platform.last_sync)"></span>
                                </div>
                                <div x-show="platform.error" class="text-sm text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 p-2 rounded">
                                    <i class="fas fa-exclamation-triangle mr-1"></i>
                                    <span x-text="platform.error"></span>
                                </div>
                            </div>

                            <!-- Platform Actions -->
                            <div class="mt-4 flex flex-wrap gap-2">
                                <button @click="configurePlatform(key)" 
                                        class="flex-1 px-3 py-2 text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors">
                                    <i class="fas fa-cog mr-1"></i>Configure
                                </button>
                                <button @click="checkPlatformHealth(key)" 
                                        class="flex-1 px-3 py-2 text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors">
                                    <i class="fas fa-heartbeat mr-1"></i>Test
                                </button>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Configuration Modal -->
                <div x-show="showPlatformConfig" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-60" x-transition>
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl">
                        <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center">
                                <i :class="getPlatformIcon(selectedPlatform)" class="mr-3"></i>
                                Configure <span x-text="selectedPlatform" class="capitalize ml-1"></span>
                            </h3>
                        </div>
                        <div class="p-6">
                            <form @submit.prevent="savePlatformConfig()">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            API Key / Token
                                        </label>
                                        <input type="password" x-model="platformConfig.api_key" 
                                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100"
                                               placeholder="Enter your API key">
                                    </div>
                                    <div x-show="needsShopId(selectedPlatform)">
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            Shop ID
                                        </label>
                                        <input type="text" x-model="platformConfig.shop_id" 
                                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100"
                                               placeholder="Enter your shop ID">
                                    </div>
                                    <div x-show="needsBaseUrl(selectedPlatform)">
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            Base URL
                                        </label>
                                        <input type="url" x-model="platformConfig.base_url" 
                                               class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-gray-100"
                                               placeholder="https://your-instance.com">
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" x-model="platformConfig.enabled" id="enablePlatform" 
                                               class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                        <label for="enablePlatform" class="ml-2 text-sm text-gray-700 dark:text-gray-300">
                                            Enable this integration
                                        </label>
                                    </div>
                                </div>
                                <div class="flex justify-end space-x-3 mt-6">
                                    <button type="button" @click="showPlatformConfig = false" 
                                            class="px-4 py-2 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700">
                                        Cancel
                                    </button>
                                    <button type="submit" 
                                            class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                        Save Configuration
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Theme Manager Modal -->
    <div x-show="showThemeManager" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" x-transition>
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-6xl h-5/6 flex flex-col">
            <!-- Header -->
            <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 flex items-center">
                        <i class="fas fa-palette mr-3 text-purple-500"></i>
                        Theme Customization
                    </h2>
                    <p class="text-gray-600 dark:text-gray-400 mt-1">Customize your interface appearance with themes, colors, fonts, and logos</p>
                </div>
                <button @click="showThemeManager = false" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <!-- Theme Manager Content -->
            <div class="flex-1 overflow-hidden">
                <div class="p-6 space-y-8 h-full overflow-y-auto">
                    
                    <!-- Theme Presets -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4 flex items-center">
                            <i class="fas fa-swatchbook mr-2 text-purple-500"></i>
                            Theme Presets
                        </h3>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                            <template x-for="(theme, key) in availableThemes" :key="key">
                                <div class="theme-preset-card border rounded-lg p-4 cursor-pointer transition-all duration-200 hover:shadow-lg" 
                                     :class="selectedTheme === key ? 'border-purple-500 bg-purple-50 dark:bg-purple-900/20' : 'border-gray-200 dark:border-gray-600'"
                                     @click="selectTheme(key, theme)">
                                    <div class="flex items-center justify-between mb-3">
                                        <h4 class="font-medium text-gray-900 dark:text-gray-100" x-text="theme.name"></h4>
                                        <div class="flex items-center space-x-1">
                                            <div class="w-4 h-4 rounded-full border" :style="`background-color: ${theme.primary_color}`"></div>
                                            <div class="w-4 h-4 rounded-full border" :style="`background-color: ${theme.secondary_color}`"></div>
                                            <div class="w-4 h-4 rounded-full border" :style="`background-color: ${theme.accent_color}`"></div>
                                        </div>
                                    </div>
                                    <div class="text-xs text-gray-600 dark:text-gray-400" x-text="theme.font_family"></div>
                                    <div class="w-full h-16 rounded mt-2 border flex items-center justify-center text-xs"
                                         :style="`background: ${theme.background_color}; color: ${theme.text_color}`">
                                        Preview
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- Custom Configuration -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4 flex items-center">
                            <i class="fas fa-sliders-h mr-2 text-purple-500"></i>
                            Custom Configuration
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Colors -->
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-gray-100 mb-3">Colors</h4>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Primary Color</label>
                                        <div class="flex items-center space-x-2">
                                            <input type="color" x-model="customTheme.primary_color" class="w-12 h-8 rounded border">
                                            <input type="text" x-model="customTheme.primary_color" class="flex-1 px-3 py-1 border rounded text-sm">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Secondary Color</label>
                                        <div class="flex items-center space-x-2">
                                            <input type="color" x-model="customTheme.secondary_color" class="w-12 h-8 rounded border">
                                            <input type="text" x-model="customTheme.secondary_color" class="flex-1 px-3 py-1 border rounded text-sm">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Accent Color</label>
                                        <div class="flex items-center space-x-2">
                                            <input type="color" x-model="customTheme.accent_color" class="w-12 h-8 rounded border">
                                            <input type="text" x-model="customTheme.accent_color" class="flex-1 px-3 py-1 border rounded text-sm">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Background Color</label>
                                        <div class="flex items-center space-x-2">
                                            <input type="color" x-model="customTheme.background_color" class="w-12 h-8 rounded border">
                                            <input type="text" x-model="customTheme.background_color" class="flex-1 px-3 py-1 border rounded text-sm">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Text Color</label>
                                        <div class="flex items-center space-x-2">
                                            <input type="color" x-model="customTheme.text_color" class="w-12 h-8 rounded border">
                                            <input type="text" x-model="customTheme.text_color" class="flex-1 px-3 py-1 border rounded text-sm">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Typography & Assets -->
                            <div>
                                <h4 class="font-medium text-gray-900 dark:text-gray-100 mb-3">Typography & Assets</h4>
                                <div class="space-y-3">
                                    <div>
                                        <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Font Family</label>
                                        <select x-model="customTheme.font_family" class="w-full px-3 py-2 border rounded text-sm">
                                            <option value="Inter, system-ui, sans-serif">Inter (Default)</option>
                                            <option value="SF Pro Display, -apple-system, sans-serif">SF Pro Display</option>
                                            <option value="JetBrains Mono, Courier New, monospace">JetBrains Mono</option>
                                            <option value="Playfair Display, Georgia, serif">Playfair Display</option>
                                            <option value="Fira Code, Monaco, monospace">Fira Code</option>
                                            <option value="Surfer, Comic Sans MS, cursive">Surfer</option>
                                            <option value="Roboto, Arial, sans-serif">Roboto</option>
                                            <option value="Poppins, sans-serif">Poppins</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Logo Upload</label>
                                        <div class="flex items-center space-x-2">
                                            <input type="file" @change="uploadLogo" accept="image/*" class="flex-1 text-sm">
                                            <button @click="removeLogo" class="px-3 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600">Remove</button>
                                        </div>
                                        <div x-show="customTheme.logo_url" class="mt-2">
                                            <img :src="customTheme.logo_url" class="h-12 object-contain border rounded">
                                        </div>
                                    </div>

                                    <div>
                                        <label class="block text-sm text-gray-700 dark:text-gray-300 mb-1">Theme Name</label>
                                        <input type="text" x-model="customTheme.name" placeholder="My Custom Theme" class="w-full px-3 py-2 border rounded text-sm">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Custom CSS -->
                        <div class="mt-6">
                            <h4 class="font-medium text-gray-900 dark:text-gray-100 mb-3">Custom CSS (Advanced)</h4>
                            <textarea x-model="customTheme.custom_css" rows="4" placeholder="/* Add your custom CSS here */" 
                                      class="w-full px-3 py-2 border rounded text-sm font-mono"></textarea>
                        </div>

                        <!-- Live Preview -->
                        <div class="mt-6">
                            <h4 class="font-medium text-gray-900 dark:text-gray-100 mb-3">Live Preview</h4>
                            <div class="border rounded-lg p-4" 
                                 :style="`background: ${customTheme.background_color}; color: ${customTheme.text_color}; font-family: ${customTheme.font_family}`">
                                <div class="flex items-center space-x-4 mb-4">
                                    <div class="w-8 h-8 rounded-full" :style="`background: ${customTheme.primary_color}`"></div>
                                    <div>
                                        <h5 class="font-semibold" :style="`color: ${customTheme.text_color}`">BreBot Dashboard</h5>
                                        <p class="text-sm opacity-70">Your AI Agent Platform</p>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button class="px-3 py-1 rounded text-sm text-white" :style="`background: ${customTheme.primary_color}`">Primary Button</button>
                                    <button class="px-3 py-1 rounded text-sm text-white" :style="`background: ${customTheme.secondary_color}`">Secondary</button>
                                    <button class="px-3 py-1 rounded text-sm text-white" :style="`background: ${customTheme.accent_color}`">Accent</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex justify-between items-center pt-6 border-t border-gray-200 dark:border-gray-700">
                        <div class="flex space-x-3">
                            <button @click="applyTheme()" class="px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors flex items-center">
                                <i class="fas fa-check mr-2"></i>Apply Theme
                            </button>
                            <button @click="previewTheme()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors flex items-center">
                                <i class="fas fa-eye mr-2"></i>Preview
                            </button>
                            <button @click="resetToDefault()" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors flex items-center">
                                <i class="fas fa-undo mr-2"></i>Reset to Default
                            </button>
                        </div>
                        <button @click="showThemeManager = false" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/dashboard.js"></script>
    <script src="/static/js/voice-widget.js"></script>
    
    <!-- PWA Installation Script -->
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('PWA install prompt triggered');
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button
            const installButton = document.createElement('button');
            installButton.textContent = 'Install Brebot App';
            installButton.className = 'fixed bottom-4 right-4 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
            installButton.onclick = () => {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    }
                    deferredPrompt = null;
                    installButton.remove();
                });
            };
            document.body.appendChild(installButton);
        });

        // PWA Installed
        window.addEventListener('appinstalled', (evt) => {
            console.log('PWA was installed');
        });
    </script>
</body>
</html>
